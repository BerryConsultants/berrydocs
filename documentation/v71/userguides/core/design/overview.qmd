---
title: "Design Tab Overview"
subtitle: "Description of what is generally specified in the design tab."
format:
  html:
    toc: true
    toc-depth: 4
    toc-title: "Table of Contents"
    number-sections: true
    number-depth: 4
---


# Design Overview

The FACTS core engine allows for the design and simulation of fixed and
adaptive clinical trials, especially focused on, but not limited to,
Bayesian designs with multiple active arms. Trials designed in the core
engines are comprised of a number of elements:

1.  [The dose response model](doseresponse.qmd): the user must specify how the doses are related to eachother in the primary analysis, though there is a simple ‘no model’ option that estimates
    the mean treatment effect of each arm independently. A fixed trial
    uses the dose response model for the final Bayesian analysis of the
    data; an adaptive trial uses the same model both for the final
    analysis and at the interim updates.

2.  The [longitudinal (predictor) model](../longitudinalmodels/overview.qmd): whether the trial is adaptive or
    fixed, the user may select to whether to use a longitudinal model
    (similarly, a predictor model in time to event). In a fixed trial
    the longitudinal model can be used to multiply impute final values for subjects that have dropped out. In an adaptive trial it is also used at the
    interim updates to multiply impute final values for subjects who have been
    recruited but do not yet have final values. In a fixed trial with no
    subject dropouts using a longitudinal model would have no effect on
    the outcome, analysis, or conduct of the trial.

3.  [Allocation rules](allocation.qmd): in a fixed trial the user just specifies the
    proportion of subjects to be recruited to each arm, and the same can
    be done in an adaptive trial (i.e. an adaptive trial does not have
    to adapt the allocation), but an adaptive trial has a range of
    options that the user can use to adapt how subjects are allocated to
    the different treatment arms as the trial progresses.

4.  [Early stopping rules](successfutility.qmd#interim-analysis-criteria): in an adaptive trial the user can select the
    criteria and specify the thresholds at which trial should be stopped
    at any interim where the conditions are satisfied. Early stopping is
    optional, and even in an adaptive design the user can opt to always
    recruit the maximum permitted number of subjects. In a fixed trial
    there are no interim analyses and hence no opportunity to stop early.

5.  [Final evaluation criteria](successfutility.qmd#final-evaluation): the same Bayesian evaluation criteria are
    available whether the trial is fixed or adaptive. The user selects
    which criteria to use and what thresholds will constitute success or
    failure. The success and failure criteria do not have to be complements of eachother, and any analysis that doesn't completely satisfy either the success or futility criteria is called, "inconclusive."

6.  [Frequentist analysis](frequentistanalysis.qmd): frequentist p-values can be calculated
    comparing each dose to the control arm (or a fixed value if there is no control). P-values can be used as decision making quantities at interim updates or final analyses. p-value cannot benefit from the dose reponse models or longitudinal models, which are specific to the Bayesian model in FACTS.

## Evaluation of Bayesian Posterior Estimates

At every interim and final analysis there is a Bayesian model fit to the data observed up to that point in the trial. The Bayesian model contains a dose
response model and, often, a longitudinal model. In the absence of a
longitudinal model, the posterior is calculated as:

$$p(\omega|Y) \propto \prod_{i = 1}^{n}{p(y_{i}|\phi)p(\phi)}$$

where $\phi$ is the set of parameters of the selected response model,
$p(\phi)$ is the prior for those parameters, $y_i$ is the
final response for each subject and $n$ is the number of subjects with complete data.

With a longitudinal model, this becomes:

$$p(\omega|Y) \propto \prod_{i = 1}^{n}{p(y_{i}|\phi)p(\phi)\prod_{i = 1}^{n}{\prod_{j = 1}^{L}{p(y_{ij}|\psi)p(\psi)}}}$$

where $\psi$ is the set of parameters of the selected longitudinal model,
$p(\psi)$ is the prior for those parameters, $y_{ij}$ is the
response for each subject $i$ at each visit $j$ and $L$ is the number of visits.

The posterior is evaluated using [MCMC](## "Markov Chain Monte Carlo") with individual parameters updated
by Metropolis Hastings (or Gibbs sampling where possible), using only
the $y_i$ and $y_{ij}$ data available at the
time of the update.
